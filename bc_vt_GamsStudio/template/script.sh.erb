#!/bin/bash
pwd
unset XDG_RUNTIME_DIR

module list

echo running on `hostname`
echo starting singularity

module load containers/singularity
#module load Qt5/5.14.1-GCCcore-9.3.0
## binding log files for troubleshooting

touch vnc.log
touch novnc.log
cat port.rc

bash start_container.sh ${TMPDIR}/<%= context.Container %> &

sleep 2
ls /tmp/.X11-unix
echo starting GAMS

echo DISPLAY:$DISPLAY
echo USER:$USER
##cat /home/${USER}/gamslice.txt

# Path to GAMS TC Image
gams_tc_img='/projects/arcsingularity/gams_tc_latest.sif'

# Bind license from user's home directory to GAMS container
gamsLicenseBindPath=/home/${USER}/gamslice.txt:/home/headless/GAMS/gams33.2_linux_x64_64_sfx/gamslice.txt

singularity exec --env DISPLAY=$DISPLAY --writable-tmpfs --bind=/tmp:/tmp,/tmp/.X11-unix:/tmp/.X11-unix,/projects:/projects,/work:/work,$gamsLicenseBindPath $gams_tc_img  bash runScript.sh
