#!/bin/bash
while [ ! -f ./connection.rc ]; do sleep 1; done
source ./connection.rc

unset XDG_RUNTIME_DIR

module list

echo running on `hostname`
echo starting singularity

module load containers/singularity

if [<%= context.cluster %> == "tinkercliffs"];then
echo loaded toolkit 11.2
module load cuda11.2/toolkit/11.2.0
else
echo loaded toolkit 11.1
module load cuda11.1/toolkit/11.1.0
fi
 

sleep 2
ls /tmp/.X11-unix
echo starting Eclipse

echo DISPLAY:$DISPLAY
echo USER:$USER


# Path to Eclipse TC Image
eclipse_img='/home/ayushchatur/dockertemp/<%= context.ide_version %>'


singularity exec --env DISPLAY=$DISPLAY --writable-tmpfs --bind=/tmp:/tmp,/tmp/.X11-unix:/tmp/.X11-unix,/projects:/projects,/work:/work $eclipse_img  /usr/bin/nsight
wait $!
